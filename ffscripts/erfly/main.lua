FiendFolio.LoadScripts({
--Items
	--Actives
	"ffscripts.erfly.items.sanguine_hook",
	"ffscripts.erfly.items.fiendfolio_thebook",
	"ffscripts.erfly.items.dogboard",
	"ffscripts.erfly.items.toycamera",
	"ffscripts.erfly.items.fiddlecube",
	"ffscripts.erfly.items.kalushead",
	"ffscripts.erfly.items.ratpoison",
	"ffscripts.erfly.items.angeliclyre",
	"ffscripts.erfly.items.lemon_mishuh",
	"ffscripts.erfly.items.grapplinghook",
	"ffscripts.erfly.items.mime_degree",
	"ffscripts.erfly.items.d2",
	"ffscripts.erfly.items.nilpasta",
	"ffscripts.erfly.items.avgm",

	--Passives
	"ffscripts.erfly.items.cetus",
	"ffscripts.erfly.items.monas_hieroglyphica",
	"ffscripts.erfly.items.deadly_dose",
	"ffscripts.erfly.items.blackmoon",
	"ffscripts.erfly.items.dadspostiche",
	"ffscripts.erfly.items.gridledcorn",
	"ffscripts.erfly.items.chaldeanaxe",
	"ffscripts.erfly.items.pennyroll",
	"ffscripts.erfly.items.evilsticker",
	"ffscripts.erfly.items.telebombs",
	"ffscripts.erfly.items.devilsdagger",
	"ffscripts.erfly.items.emojiglasses",
	"ffscripts.erfly.items.devilsabacus",
	"ffscripts.erfly.items.x10shitposts",
	"ffscripts.erfly.items.infinityvolt",
	"ffscripts.erfly.items.devilsumbrella",
	"ffscripts.erfly.items.beeskin",
	"ffscripts.erfly.items.crazyjackpot",
	"ffscripts.erfly.items.moms_stockings",
	"ffscripts.erfly.items.goldenpopsicle",
	"ffscripts.erfly.items.timeitself",
	"ffscripts.erfly.items.horncob",
	"ffscripts.erfly.items.youreternalreward",
	"ffscripts.erfly.items.modernouroboros",
	"ffscripts.erfly.items.boxtop",
	"ffscripts.erfly.items.kindaegg",
	"ffscripts.erfly.items.smashtrophy",
	"ffscripts.erfly.items.bottleofwater",

	--Familiars
	"ffscripts.sewingmachine",
	"ffscripts.erfly.familiars.baby_crater",
	"ffscripts.erfly.familiars.mamaspooter",
	"ffscripts.erfly.familiars.lil_fiend",
	"ffscripts.erfly.familiars.randy_the_snail",
	"ffscripts.erfly.familiars.grabber",
	"ffscripts.erfly.familiars.peach_creep",
	"ffscripts.erfly.familiars.gorgon",
	"ffscripts.erfly.familiars.deimos",
	"ffscripts.erfly.familiars.petrock",
	"ffscripts.erfly.familiars.ophiuchus",
	"ffscripts.erfly.familiars.baby_orb",
	"ffscripts.erfly.familiars.attack_skuzz",
	"ffscripts.erfly.familiars.greg",
	"ffscripts.erfly.familiars.orangeboomfly",
	"ffscripts.erfly.familiars.lil_lamb",
	"ffscripts.erfly.familiars.d3",
	"ffscripts.erfly.familiars.wimpy_bro",
	"ffscripts.erfly.familiars.robobaby3",
	"ffscripts.erfly.familiars.sackofspicy",
	"ffscripts.erfly.familiars.clutchscurse",
	"ffscripts.erfly.familiars.petpeeve",
	"ffscripts.erfly.familiars.bagofbobbies",

	--Trinkets
	"ffscripts.erfly.trinkets.swallowed_m90",
	"ffscripts.erfly.trinkets.jevilstail",
	"ffscripts.erfly.trinkets.dealmakers",
	"ffscripts.erfly.trinkets.lostflowercrown",
	"ffscripts.erfly.trinkets.middlehand",
	"ffscripts.erfly.trinkets.rainbowbean",
	"ffscripts.erfly.trinkets.solemnvow",
	--Rocks
	"ffscripts.erfly.trinkets.rocks.brick_rock",
	"ffscripts.erfly.trinkets.rocks.sapphic_sapphire",
	"ffscripts.erfly.trinkets.rocks.blood_diamond",
	"ffscripts.erfly.trinkets.rocks.nitro_crystal",
	"ffscripts.erfly.trinkets.rocks.unobtainium",
	"ffscripts.erfly.trinkets.rocks.minichibisidian",
	"ffscripts.erfly.trinkets.rocks.friendlyrapidfireopal",
	--Fossils
	"ffscripts.erfly.trinkets.rocks.fossil_rerolligan",
	"ffscripts.erfly.trinkets.rocks.fossil_thankyou",
	--Geodes

	--Cards
	"ffscripts.erfly.cards.other",
	"ffscripts.erfly.cards.grotto_beast",
	"ffscripts.erfly.cards.skip_card",
	"ffscripts.erfly.cards.energy_card",
	"ffscripts.erfly.cards.cardjitsu",
	"ffscripts.erfly.cards.gift_card",
	--Suit Cards
	"ffscripts.erfly.cards.suit_ace",
	"ffscripts.erfly.cards.suit_two",
	"ffscripts.erfly.cards.suit_three",
	"ffscripts.erfly.cards.suit_jack",
	"ffscripts.erfly.cards.suit_queen",
	"ffscripts.erfly.cards.suit_king",
	"ffscripts.erfly.cards.suit_other",
	--Runes
	"ffscripts.erfly.cards.runes",
	"ffscripts.erfly.cards.souls",
	--Objects
	"ffscripts.erfly.cards.greenhouse",
	"ffscripts.erfly.cards.tophat",

	--Pills
	"ffscripts.erfly.misc.ffpillcolors",
	"ffscripts.erfly.misc.melatonin",

	--Pickups
	"ffscripts.erfly.misc.glasschest",
	"ffscripts.erfly.misc.token",

	--Machines
	"ffscripts.erfly.slots.pokertable",
	"ffscripts.erfly.slots.phonebooth",
	"ffscripts.erfly.slots.goldenslotmachine",
	"ffscripts.erfly.slots.jukebox",
	--Beggars
	"ffscripts.erfly.slots.hugbeggar",
	"ffscripts.erfly.slots.cosplaybeggar",

	--Other
	"ffscripts.modcompat.andromeda",
	"ffscripts.erfly.misc.funnybinds",
	"ffscripts.erfly.misc.commands",
	"ffscripts.erfly.misc.fortunehandling",
	"ffscripts.erfly.misc.fortunes",
	"ffscripts.erfly.misc.fortunes_rules",
	"ffscripts.erfly.misc.localisation_lib",
	"ffscripts.erfly.misc.tauntingmusic",
	"ffscripts.erfly.misc.objectspawner",
	"ffscripts.erfly.misc.slippy",	--FROG MDOE
	"ffscripts.erfly.misc.fient",
	"ffscripts.erfly.misc.fend",
	"ffscripts.erfly.misc.wingedfiend",
	"ffscripts.erfly.misc.letitemdungeonrocksbreak",

--Enemies
	--Shared
	"ffscripts.erfly.enemies._shared",
	"ffscripts.erfly.enemies._proapi",
	--Bosses
	--"ffscripts.erfly.bosses.monsoon_moistro_jackthedripper",
	"ffscripts.erfly.bosses.aquagob",
	"ffscripts.erfly.bosses.cacamancer",
	"ffscripts.erfly.bosses.dusk",
	"ffscripts.erfly.bosses.heiress",
	"ffscripts.erfly.bosses.psion",
	"ffscripts.erfly.bosses.monsoon",

	"ffscripts.erfly.bosses.vanillachampions",

	"ffscripts.erfly.enemies.revHazards",

	--Jokes
	"ffscripts.erfly.enemies.motherorb",
	"ffscripts.erfly.enemies.jackson",
	"ffscripts.erfly.enemies.peat",
	"ffscripts.erfly.enemies.horse",
	"ffscripts.erfly.enemies.reheated",
	"ffscripts.erfly.enemies.mern",
	"ffscripts.erfly.enemies.spidernicalis",
	"ffscripts.erfly.enemies.baba",
	"ffscripts.erfly.enemies.fishnuclearthrone",
	"ffscripts.erfly.enemies.crudemate",
	"ffscripts.erfly.enemies.carrot",
	--Regular
	"ffscripts.erfly.enemies.shroomleaper",
	"ffscripts.erfly.enemies.spicydip",
	"ffscripts.erfly.enemies.poople",
	"ffscripts.erfly.enemies.dung",
	"ffscripts.erfly.enemies.nerve",
	"ffscripts.erfly.enemies.meatwad",
	"ffscripts.erfly.enemies.gutbuster",
	"ffscripts.erfly.enemies.morsel",
	"ffscripts.erfly.enemies.frog",
	"ffscripts.erfly.enemies.motor_neuron",
	"ffscripts.erfly.enemies.dweller",
	"ffscripts.erfly.enemies.warty",
	"ffscripts.erfly.enemies.gunk",
	"ffscripts.erfly.enemies.gleek",
	"ffscripts.erfly.enemies.ribeye",
	"ffscripts.erfly.enemies.hollowknight",
	"ffscripts.erfly.enemies.gorger",
	"ffscripts.erfly.enemies.drop",
	"ffscripts.erfly.enemies.dribble",
	"ffscripts.erfly.enemies.spark",
	"ffscripts.erfly.enemies.fossil",
	"ffscripts.erfly.enemies.sentry",
	"ffscripts.erfly.enemies.mold",
	"ffscripts.erfly.enemies.balor",
	"ffscripts.erfly.enemies.eyesore",
	"ffscripts.erfly.enemies.beeter",
	"ffscripts.erfly.enemies.liljon",
	"ffscripts.erfly.enemies.crosseyes",
	"ffscripts.erfly.enemies.tadokid",
	"ffscripts.erfly.enemies.toxicknight",
	"ffscripts.erfly.enemies.haunted",
	"ffscripts.erfly.enemies.fishface",
	"ffscripts.erfly.enemies.bubblebaby",
	"ffscripts.erfly.enemies.spitum",
	"ffscripts.erfly.enemies.ghostse",
	"ffscripts.erfly.enemies.flare",
	"ffscripts.erfly.enemies.incisor",
	"ffscripts.erfly.enemies.starving",
	"ffscripts.erfly.enemies.woodburner",
	"ffscripts.erfly.enemies.milktooth",
	"ffscripts.erfly.enemies.squire",
	"ffscripts.erfly.enemies.foreseer",
	"ffscripts.erfly.enemies.psionleech",
	"ffscripts.erfly.enemies.fumegeist",
	"ffscripts.erfly.enemies.sourpatch",
	"ffscripts.erfly.enemies.bloodcell",
	"ffscripts.erfly.enemies.madclaw",
	"ffscripts.erfly.enemies.headhoncho",
	"ffscripts.erfly.enemies.colonel",
	"ffscripts.erfly.enemies.globulon",
	"ffscripts.erfly.enemies.primemind",
	"ffscripts.erfly.enemies.charlie",
	"ffscripts.erfly.enemies.sooty",
	"ffscripts.erfly.enemies.smokin",
	"ffscripts.erfly.enemies.flickerspirit",
	"ffscripts.erfly.enemies.deadfly",
	"ffscripts.erfly.enemies.dogmeat",
	"ffscripts.erfly.enemies.brooter",
	"ffscripts.erfly.enemies.tap",
	"ffscripts.erfly.enemies.tallboi",
	"ffscripts.erfly.enemies.peepling",
	"ffscripts.erfly.enemies.harletwin",
	"ffscripts.erfly.enemies.gis",
	"ffscripts.erfly.enemies.centipede",
	"ffscripts.erfly.enemies.mullikaboom",
	"ffscripts.erfly.enemies.poobottle",
	"ffscripts.erfly.enemies.grater",
	"ffscripts.erfly.enemies.tombit",
	"ffscripts.erfly.enemies.homer",
	"ffscripts.erfly.enemies.gishle",
	"ffscripts.erfly.enemies.hover",
	"ffscripts.erfly.enemies.saggingsucker",
	"ffscripts.erfly.enemies.redhorf",
	"ffscripts.erfly.enemies.zapbladder",
	"ffscripts.erfly.enemies.piper",
	"ffscripts.erfly.enemies.scytherider",
	"ffscripts.erfly.enemies.msdominator",
	"ffscripts.erfly.enemies.fossilizedboomfly",
	"ffscripts.erfly.enemies.stingler",
	"ffscripts.erfly.enemies.trickle",
	"ffscripts.erfly.enemies.grape",
	"ffscripts.erfly.enemies.fishaac",
	"ffscripts.erfly.enemies.bumbler",
	"ffscripts.erfly.enemies.menace",
	"ffscripts.erfly.enemies.thousandeyes",
	"ffscripts.erfly.enemies.warden",
	"ffscripts.erfly.enemies.erodedhost",
	"ffscripts.erfly.enemies.immural",
	"ffscripts.erfly.enemies.shiitake",
	"ffscripts.erfly.enemies.bowler",
	"ffscripts.erfly.enemies.mrhorf",
	"ffscripts.erfly.enemies.cordify",
	"ffscripts.erfly.enemies.spook",
	"ffscripts.erfly.enemies.uteropillar",
	"ffscripts.erfly.enemies.honeydrip",
	"ffscripts.erfly.enemies.slim",
	"ffscripts.erfly.enemies.pester",
	"ffscripts.erfly.enemies.ramblinmushroom",
	"ffscripts.erfly.enemies.bola",
	"ffscripts.erfly.enemies.smidgen",
	"ffscripts.erfly.enemies.looker",
	"ffscripts.erfly.enemies.peekaboo",
	"ffscripts.erfly.enemies.ringofringflies",
	"ffscripts.erfly.enemies.drshambles",
	"ffscripts.erfly.enemies.enlightened",
	"ffscripts.erfly.enemies.mrgob",
	"ffscripts.erfly.enemies.globscraper",
	"ffscripts.erfly.enemies.psihunter",
	"ffscripts.erfly.enemies.psiling",
	"ffscripts.erfly.enemies.umbra",
	"ffscripts.erfly.enemies.seeker",
	"ffscripts.erfly.enemies.cword",
	"ffscripts.erfly.enemies.flanks",
	"ffscripts.erfly.enemies.carrier",
	"ffscripts.erfly.enemies.quack",
	"ffscripts.erfly.enemies.lipoma",
	"ffscripts.erfly.enemies.nannylonglegs",
	"ffscripts.erfly.enemies.coby",
	"ffscripts.erfly.enemies.fingore",
	"ffscripts.erfly.enemies.minimin",
	"ffscripts.erfly.enemies.gutter",
	"ffscripts.erfly.enemies.sixth",
	"ffscripts.erfly.enemies.residuum",
	"ffscripts.erfly.enemies.technician",
	"ffscripts.erfly.enemies.looksee",
	"ffscripts.erfly.enemies.clergy",
	"ffscripts.erfly.enemies.stolas",
	"ffscripts.erfly.enemies.deathany",
	"ffscripts.erfly.enemies.bull",
	"ffscripts.erfly.enemies.geyser",
	"ffscripts.erfly.enemies.supergrimace",
	"ffscripts.erfly.enemies.maggaper",
	"ffscripts.erfly.enemies.aper",
	"ffscripts.erfly.enemies.matte",
	"ffscripts.erfly.enemies.bunkerworm",
	"ffscripts.erfly.enemies.buckethead",
	"ffscripts.erfly.enemies.bubby",
	"ffscripts.erfly.enemies.discy",
	"ffscripts.erfly.enemies.beebee",
	"ffscripts.erfly.enemies.delinquent",
	"ffscripts.erfly.enemies.slobber",
	"ffscripts.erfly.enemies.grinner",
	"ffscripts.erfly.enemies.mobilemushroom",
	"ffscripts.erfly.enemies.onlyfan",
	"ffscripts.erfly.enemies.trojan",
})

--------------------------------------------------------------------------------------------

local mod = FiendFolio

mod.ErflyEnemyDict = {
	--Jokes
	[mod.FF.MotherOrb.Var] = {
		Update = mod.debugToolAI,
		Hurt = mod.motherOrbHurt,
		Coll = mod.motherOrbColl
	},
	[mod.FF.Jackson.Var] = {
		Update = mod.jacksonAI,
	},
	[mod.FF.Freezer.Var] = {
		Update = mod.theFreezerAI,
		Hurt = mod.returnFalse
	},
	[mod.FF.Peat.Var] = {
		Update = mod.peatAI,
	},
	[mod.FF.Horse.Var] = {
		Update = mod.theHorseAI,
		Coll = mod.theHorseColl
	},
	[mod.FF.StableHorse.Var] = {
		Update = mod.stableHorseAI,
		Coll = mod.stableHorseColl
	},
	[mod.FF.StablePony.Var] = {
		Update = mod.stableHorseAI,
		Coll = mod.stableHorseColl
	},
	[mod.FF.StableTainted.Var] = {
		Update = mod.stableHorseAI,
		Coll = mod.stableHorseColl
	},
	[mod.FF.ReheatedBeserker.Var] = {
		Update = mod.reheatedBeserkerAI,
	},
	[mod.FF.IsaacReheated.Var] = {
		Update = mod.boiReheatedAI,
	},
	[mod.FF.Mern.Var] = {
		Update = mod.mernAI,
	},
	[mod.FF.SpiderNicalis.Var] = {
		Update = mod.koalaAI,
	},
	[mod.FF.BabaIsEnemy.Var] = {
		Update = mod.babaIsEnemy,
	},
	[mod.FF.FishNuclearThrone.Var] = {
		Update = mod.oopsWrongGame,
		Hurt = mod.fishNuclearThroneHurt
	},
	[mod.FF.Crudemate.Var] = {
		Update = mod.crudemateAI,
	},
	[mod.FF.Carrot.Var] = {
		Update = mod.carrotAI,
	},
	--Regular
	[mod.FF.Fatshroom.Var] = {
		Update = mod.fatShroomAI,
	},
	[mod.FF.ShroomLeaper.Var] = {
		Update = mod.shroomLeaperAI,
	},
	[mod.FF.Berry.Var] = {
		Update = mod.berryAI,
		Hurt = mod.berryHurt,
	},
	[mod.FF.SpicyDip.Var] = {
		Update = mod.spicyDipAI,
		Hurt = mod.spicyDipHurt,
	},
	[mod.FF.Poople.Var] = {
		Update = mod.poopleAI,
	},
	[mod.FF.Dung.Var] = {
		Update = mod.clotterAI,
	},
	--[[[mod.FF.Nerve.Var] = {
		Update = mod.nerveRelay,
		Init = mod.nerveInit
	},]]
	[mod.FF.Meatwad.Var] = {
		Update = mod.conkerAI,
		Hurt = mod.meatwadHurt,
	},
	[mod.FF.Slag.Var] = {
		Update = mod.conkerAI,
	},
	[mod.FF.Pox.Var] = {
		Update = mod.conkerAI,
	},
	[mod.FF.Haunch.Var] = {
		Update = mod.conkerAI,
	},
	[mod.FF.Outlier.Var] = {
		Update = mod.conkerAI,
	},
	[mod.FF.GrilledMeatwad.Var] = {
		Update = mod.conkerAI,
		Hurt = mod.meatwadHurt,
	},
	[mod.FF.Offal.Var] = {
		Update = mod.gutbusterGutsAI,
		Init = mod.offalInit
	},
	[mod.FF.DriedOffal.Var] = {
		Update = mod.gutbusterGutsAI,
		Init = mod.offalInit
	},
	[mod.FF.Morsel.Var] = {
		Update = mod.morselAI,
		Init = mod.morselInit
	},
	[mod.FF.Falafel.Var] = {
		Update = mod.falafelAI,
		Init = mod.morselInit
	},
	[mod.FF.Slick.Var] = {
		Update = mod.morselAI,
		Init = mod.morselInit
	},
	[mod.FF.Stump.Var] = {
		Update = mod.morselAI,
		Init = mod.morselInit
	},
	[mod.FF.Frog.Var] = {
		Update = mod.frogAI
	},
	[mod.FF.MotorNeuron.Var] = {
		Update = mod.walkingNerveAI,
	},
	[mod.FF.Dweller.Var] = {
		Update = mod.dwellerAI,
		Hurt = mod.dwellerHurt
	},
	[mod.FF.DwellerBrother.Var] = {
		Update = mod.dwellerBobbyAI,
	},
	[mod.FF.TDweller.Var] = {
		Update = mod.dwellerTAI,
		Hurt = mod.deepDwellerHurt
	},
	[mod.FF.TDwellerBrother.Var] = {
		Update = mod.dwellerTBobbyAI,
	},
	[mod.FF.Warty.Var] = {
		Update = mod.wartyAI,
		Hurt = mod.wartyHurt,
	},
	[mod.FF.Gunk.Var] = {
		Update = mod.gunkAI,
		Hurt = mod.gunkHurt,
	},
	[mod.FF.Punk.Var] = {
		Update = mod.gunkAI,
		Hurt = mod.gunkHurt,
	},
	[mod.FF.Gleek.Var] = {
		Update = mod.gleekAI,
	},
	[mod.FF.Ribeye.Var] = {
		Update = mod.ribeyeAI,
		Hurt = mod.ribeyeHurt,
	},
	[mod.FF.Cortex.Var] = {
		Update = mod.cortexAI,
		Hurt = mod.cortexHurt,
		Kill = mod.cortexKill,
		Coll = mod.cortexColl
	},
	[mod.FF.Gorger.Var] = {
		Update = mod.gorgerAI,
		Coll = mod.gorgerColl,
		Hurt = mod.gorgerHurt,
		Kill = mod.gorgerKill,
	},
	[mod.FF.Drop.Var] = {
		Update = mod.dripAI,
		Hurt = mod.dripHurt,
	},
	[mod.FF.Dribble.Var] = {
		Update = mod.dribbleAI,
	},
	[mod.FF.Spark.Var] = {
		Update = mod.sparkAI,
		Hurt = mod.sparkHurt,
	},
	[mod.FF.Fossil.Var] = {
		Update = mod.fossilAI,
	},
	[mod.FF.Sentry.Var] = {
		Update = mod.sentryAI,
		Hurt = mod.sentryHurt,
		Coll = mod.sentryColl,
	},
	[mod.FF.Mold.Var] = {
		Update = mod.moldAI,
		Hurt = mod.moldHurt
	},
	[mod.FF.Balor.Var] = {
		Update = mod.balorAI,
	},
	[mod.FF.Eyesore.Var] = {
		Update = mod.eyesoreAI,
	},
	[mod.FF.Gander.Var] = {
		Update = mod.ganderAI,
		Hurt = mod.returnFalse,
	},
	[mod.FF.Beeter.Var] = {
		Update = mod.beeterAI,
	},
	[mod.FF.LilJon.Var] = {
		Update = mod.lilJonAI,
		Hurt = mod.returnFalse,
	},
	[mod.FF.Crosseyes.Var] = {
		Update = mod.crossEyesAI,
	},
	[mod.FF.TadoKid.Var] = {
		Update = mod.tadoKidAI,
		Kill = mod.tadoKidKill,
	},
	[mod.FF.ToxicKnight.Var] = {
		Update = mod.toxicKnightAI,
		Coll = mod.toxicKnightColl,
		Hurt = mod.toxicKnightHurt,
		Kill = mod.toxicKnightKill
	},
	[mod.FF.Haunted.Var] = {
		Update = mod.hauntedAI,
	},
	[mod.FF.Yawner.Var] = {
		Update = mod.yawnerAI,
	},
	[mod.FF.Fishface.Var] = {
		Update = mod.fishfaceAI,
	},
	[mod.FF.FishfaceShiny.Var] = {
		Update = mod.fishfaceAI,
	},
	[mod.FF.BubbleBaby.Var] = {
		Update = mod.bubbleBabyAI,
		Coll = mod.bubbleBabyColl,
	},
	[mod.FF.Spitum.Var] = {
		Update = mod.spitumAI,
	},
	[mod.FF.Ghostse.Var] = {
		Update = mod.ghostseAI,
	},
	[mod.FF.GhostseEasy.Var] = {
		Update = mod.ghostseEasyModeAI,
		Coll = mod.ghostseEasyColl
	},
	[mod.FF.GhostseSeptic.Var] = {
		Update = mod.ghostseAI,
		Hurt = mod.ghostseSepticHurt
	},
	[mod.FF.Flare.Var] = {
		Update = mod.mrFlareAI,
		Hurt = mod.flareHurt,
	},
	[mod.FF.Crisply.Var] = {
		Update = mod.mrCrisplyAI,
	},
	[mod.FF.Incisor.Var] = {
		Update = mod.incisorAI,
	},
	[mod.FF.Starving.Var] = {
		Update = mod.starvingAI,
	},
	[mod.FF.Woodburner.Var] = {
		Update = mod.woodburnerAI,
		Hurt = mod.woodburnerHurt
	},
	[mod.FF.WoodburnerEasy.Var] = {
		Update = mod.woodburnerEasyModeAI,
		Coll = mod.woodburnerEasyColl
	},
	[mod.FF.MilkTooth.Var] = {
		Update = mod.babyBatAI,
	},
	[mod.FF.Squire.Var] = {
		Update = mod.squireAI,
	},
	[mod.FF.Foreseer.Var] = {
		Update = mod.foreseerAI,
	},
	[mod.FF.PsionLeech.Var] = {
		Update = mod.psionicLeechAI,
	},
	[mod.FF.Fumegeist.Var] = {
		Update = mod.fumegeistAI,
		Hurt = mod.fumegeistHurt,
	},
	[mod.FF.Mote.Var] = {
		Update = mod.moteAI,
		Coll = mod.moteColl,
		Hurt = mod.moteHurt,
	},
	[mod.FF.Sourpatch.Var] = {
		Update = mod.sourpatchAI,
		Kill = mod.sourpatchKill,
	},
	[mod.FF.SourpatchBody.Var] = {
		Update = mod.sourpatchBodyAI,
	},
	[mod.FF.BloodCell.Var] = {
		Update = mod.bloodCellAI,
	},
	[mod.FF.BloodCellAir.Var] = {
		Update = mod.bloodCellAI,
	},
	[mod.FF.Madclaw.Var] = {
		Update = mod.madclawAI,
		Coll = mod.madclawColl
	},
	[mod.FF.HeadHoncho.Var] = {
		Update = mod.headHonchoAI,
		Hurt = mod.headHonchoHurt,
	},
	[mod.FF.Colonel.Var] = {
		Update = mod.colonelRelay,
	},
	[mod.FF.Zingling.Var] = {
		Update = mod.zinglingAI,
	},
	[mod.FF.Zingy.Var] = {
		Update = mod.zingyAI,
	},
	[mod.FF.Globulon.Var] = {
		Update = mod.globulonAI,
		Hurt = mod.globulonHurt
	},
	[mod.FF.Primemind.Var] = {
		Update = mod.primemindAI,
	},
	[mod.FF.Charlie.Var] = {
		Update = mod.charlieAI,
	},
	[mod.FF.Sooty.Var] = {
		Update = mod.sootyAI,
	},
	[mod.FF.SmokinOld.Var] = {
		Update = mod.smokinUltimateAI,
		Hurt = mod.smokinUltimateHurt
	},
	[mod.FF.Smokin.Var] = {
		Update = mod.smokinAI,
	},
	[mod.FF.Flamin.Var] = {
		Update = mod.flaminAI,
		Hurt = mod.returnFalse,
	},
	[mod.FF.FlaminChain.Var] = {
		Update = mod.flaminChainAI,
		Hurt = mod.returnFalse,
	},
	[mod.FF.Flickerspirit.Var] = {
		Update = mod.flickerspiritAI,
	},
	[mod.FF.EternalFlickerspirit.Var] = {
		Update = mod.eternalFlickerspiritAI,
		Hurt = mod.eternalFlickerspiritHurt,
		Init = mod.eternalFlickerspiritInit
	},
	[mod.FF.DeadFly.Var] = {
		Update = mod.deadflyAI,
	},
	[mod.FF.DeadFlyOrbital.Var] = {
		Update = mod.deadflyEternalFlyAI,
		Hurt = mod.returnFalse,
	},
	[mod.FF.Dogmeat.Var] = {
		Update = mod.dogmeatAI,
		Hurt = mod.dogmeatHurt,
	},
	[mod.FF.Brooter.Var] = {
		Update = mod.brooterAI,
	},
	[mod.FF.Tap.Var] = {
		Update = mod.tapAI,
		Hurt = mod.returnFalse,
	},
	[mod.FF.Tallboi.Var] = {
		Update = mod.tallBoiAI,
		Hurt = mod.tallBoiHurt
	},
	[mod.FF.Shitling.Var] = {
		Update = mod.shitlingAI,
	},
	[mod.FF.ReallyTallboi.Var] = {
		Update = mod.reallyTallBoiAI,
		Hurt = mod.reallyTallBoiHurt
	},
	[mod.FF.Peepling.Var] = {
		Update = mod.peeplingAI,
	},
	[mod.FF.Harletwin.Var] = {
		Update = mod.effigyAI,
	},
	[mod.FF.Effigy.Var] = {
		Update = mod.effigyAI,
	},
	[mod.FF.Gis.Var] = {
		Update = mod.gisAI,
	},
	[mod.FF.Centipede.Var] = {
		Update = mod.centipedeAI,
		Hurt = mod.centipedeHurt,
		Coll = mod.centipedeColl
	},
	[mod.FF.CentipedeAngy.Var] = {
		Update = mod.centipedeAI,
		Hurt = mod.centipedeHurt,
		Coll = mod.centipedeColl
	},
	[mod.FF.Mullikaboom.Var] = {
		Update = mod.smokingMulliganAI,
		Coll = mod.mullikaboomColl,
	},
	[mod.FF.Poobottle.Var] = {
		Update = mod.poobottleAI,
		Hurt = mod.poobottleHurt,
	},
	[mod.FF.Drainfly.Var] = {
		Update = mod.poobottleAI,
		Hurt = mod.poobottleHurt,
	},
	[mod.FF.Grater.Var] = {
		Update = mod.graterAI,
	},
	[mod.FF.Tombit.Var] = {
		Update = mod.tombitAI,
		Hurt = mod.returnFalse,
	},
	[mod.FF.Gravin.Var] = {
		Update = mod.gravinAI,
	},
	[mod.FF.Homer.Var] = {
		Update = mod.homerAI,
	},
	[mod.FF.Gishle.Var] = {
		Update = mod.gishleAI,
	},
	[mod.FF.Hover.Var] = {
		Update = mod.hoverAI,
	},
	[mod.FF.SaggingSucker.Var] = {
		Update = mod.saggerAI,
	},
	[mod.FF.RedHorf.Var] = {
		Update = mod.redHorfAI,
	},
	[mod.FF.ShittyHorf.Var] = {
		Update = mod.redHorfAI,
	},
	[mod.FF.Zapbladder.Var] = {
		Update = mod.zapBladderAI,
	},
	[mod.FF.Wire.Var] = {
		Update = mod.wireAI,
	},
	[mod.FF.Piper.Var] = {
		Update = mod.piperAI,
	},
	[mod.FF.ScytheRider.Var] = {
		Update = mod.scytheRiderAI,
	},
	[mod.FF.PitchforkHitcher.Var] = {
		Update = mod.scytheRiderAI,
		Hurt = mod.pitchforkhitcherhurt,
	},
	[mod.FF.Reaper.Var] = {
		Update = mod.reaperAI,
	},
	[mod.FF.MsDominator.Var] = {
		Update = mod.msDominatorAI,
	},
	[mod.FF.Dominated.Var] = {
		Update = mod.dominatorBegottenAI,
	},
	[mod.FF.FossilBoomFly.Var] = {
		Update = mod.fossilizedBoomFlyAI,
	},
	[mod.FF.Stingler.Var] = {
		Update = mod.stinglerAI,
		Hurt = mod.stinglerHurt
	},
	[mod.FF.Trickle.Var] = {
		Update = mod.trickleAI,
		Hurt = mod.trickleHurt
	},
	[mod.FF.Bunch.Var] = {
		Update = mod.grapeAI,
	},
	[mod.FF.Fishaac.Var] = {
		Update = mod.fishaacAI,
		Hurt = mod.fishaacHurt,
	},
	[mod.FF.Bumbler.Var] = {
		Update = mod.bumblerAI,
	},
	[mod.FF.Buckshot.Var] = {
		Update = mod.bumblerAI,
	},
	[mod.FF.Menace.Var] = {
		Update = mod.menaceAI,
	},
	[mod.FF.ThousandEyes.Var] = {
		Update = mod.thousandEyesAI,
	},
	[mod.FF.Warden.Var] = {
		Update = mod.wardenAI,
		Hurt = mod.wardenHurt,
	},
	[mod.FF.ErodedHost.Var] = {
		Update = mod.erodedHostAI,
		Hurt = mod.erodedHostHurt
	},
	[mod.FF.Immural.Var] = {
		Update = mod.immuralAI,
		Hurt = mod.returnFalse
	},
	[mod.FF.Shiitake.Var] = {
		Update = mod.shiitakeAI,
		Init = mod.shiiitakeInit,
	},
	[mod.FF.Bowler.Var] = {
		Update = mod.bowlerRelay,
		Hurt = mod.bowlerHurt,
	},
	[mod.FF.Striker.Var] = {
		Update = mod.bowlerRelay,
		Hurt = mod.bowlerHurt,
	},
	[mod.FF.BowlerSeptic.Var] = {
		Update = mod.bowlerRelay,
		Hurt = mod.bowlerHurt,
	},
	[mod.FF.MrHorf.Var] = {
		Update = mod.mrHorfAI,
		Kill = mod.mrHorfKill,
	},
	[mod.FF.MrHorfHead.Var] = {
		Update = mod.mrHorfHeadAI,
	},
	[mod.FF.MrRedHorf.Var] = {
		Update = mod.mrHorfAI,
		Kill = mod.mrHorfKill,
	},
	[mod.FF.MrRedHorfHead.Var] = {
		Update = mod.mrHorfHeadAI,
	},
	[mod.FF.Cordify.Var] = {
		Update = mod.cordifyAI,
	},
	[mod.FF.Spook.Var] = {
		Update = mod.spookAI,
		Hurt = mod.spookHurt,
	},
	[mod.FF.UteroPillar.Var] = {
		Update = mod.uteroPillarAI,
		Hurt = mod.uteroPillarHurt
	},
	[mod.FF.Organelle.Var] = {
		Update = mod.organelleAI,
		Coll = mod.organelleColl
	},
	[mod.FF.Honeydrip.Var] = {
		Update = mod.honeydripAI,
	},
	[mod.FF.Slim.Var] = {
		Update = mod.slimRelay,
	},
	[mod.FF.PaleSlim.Var] = {
		Update = mod.slimRelay,
		Kill = mod.paleSlimKill,
	},
	[mod.FF.SlimShady.Var] = {
		Update = mod.slimRelay,
	},
	[mod.FF.Pester.Var] = {
		Update = mod.pesterAI,
		Kill = mod.pesterKill
	},
	[mod.FF.RamblinEvilMushroom.Var] = {
		Update = mod.mushroomFromMotherSeriesIncludingHitGameEarthboundAI,
	},
	[mod.FF.Bola.Var] = {
		Update = mod.bolaAI,
		Coll = mod.bolaColl,
		Hurt = mod.bolaHurt
	},
	[mod.FF.Smidgen.Var] = {
		Update = mod.smidgenAI,
		Hurt = mod.smidgenHurt
	},
	[mod.FF.RedSmidgen.Var] = {
		Update = mod.smidgenAI,
	},
	[mod.FF.ErodedSmidgen.Var] = {
		Update = mod.smidgenAI,
		Hurt = mod.smidgenHurt
	},
	[mod.FF.Tittle.Var] = {
		Update = mod.smidgenAI,
		Hurt = mod.smidgenHurt
	},
	[mod.FF.Looker.Var] = {
		Update = mod.lookerAI,
	},
	[mod.FF.Peekaboo.Var] = {
		Update = mod.peekabooAI,
	},
	[mod.FF.PeekabooEye.Var] = {
		Update = mod.peekabooEyeAI,
		Hurt = mod.returnFalse
	},
	[mod.FF.RingOfRingFlies.Var] = {
		Update = mod.ringFlyOcter,
	},
	[mod.FF.DrShambles.Var] = {
		Update = mod.drShambles,
	},
	[mod.FF.InnerEye.Var] = {
		Update = mod.innerEyeAI,
	},
	[mod.FF.Enlightened.Var] = {
		Update = mod.enlightenedAI,
		Hurt = mod.enlightenedHurt
	},
	[mod.FF.MrGob.Var] = {
		Update = mod.mrGobAI,
		Coll = mod.mrGobColl
	},
	[mod.FF.Gob.Var] = {
		Update = mod.regularGobAI,
	},
	[mod.FF.Globscraper.Var] = {
		Update = mod.globscraperAI,
		Hurt = mod.globscraperHurt
	},
	[mod.FF.Foe.Var] = {
		--In dead's files
		Update = mod.foeAI,
	},
	[mod.FF.Psihunter.Var] = {
		Update = mod.psihunterAI,
		Hurt = mod.psihunterHurt,
	},
	[mod.FF.Psiling.Var] = {
		Update = mod.psiling,
	},
	[mod.FF.Umbra.Var] = {
		Update = mod.umbraAI,
		Coll = mod.umbraColl
	},
	[mod.FF.Eclipse.Var] = {
		Update = mod.eclipseAI,
		Hurt = mod.returnFalse
	},
	[mod.FF.Seeker.Var] = {
		Update = mod.seekerAI,
	},
	[mod.FF.CWord.Var] = {
		Update = mod.cwordAI,
		Hurt = mod.returnFalse
	},
	[mod.FF.Neonate.Var] = {
		Update = mod.neonateAI,
	},
	[mod.FF.Flanks.Var] = {
		Update = mod.flanksAI,
	},
	[mod.FF.Carrier.Var] = {
		Update = mod.carrierAI,
		Hurt = mod.carrierHurt,
	},
	[mod.FF.Quack.Var] = {
		Update = mod.quackAI,
		Hurt = mod.quackHurt,
	},
	[mod.FF.Lipoma.Var] = {
		Update = mod.lipomaAI,
	},
	[mod.FF.NannyLongLegs.Var] = {
		Update = mod.nannyLongLegsAI,
		Hurt = mod.nannyLongLegsHurt
	},
	[mod.FF.Coby.Var] = {
		Update = mod.cobyAI,
	},
	[mod.FF.Fingore.Var] = {
		Update = mod.fingoreAI,
		Hurt = mod.fingoreHurt
	},
	[mod.FF.FingoreHand.Var] = {
		Update = mod.fingoreScrupulatorAI,
		Hurt = mod.returnFalse,
		Coll = mod.fingoreHandColl
	},
	[mod.FF.MiniMinMin.Var] = {
		Update = mod.miniMinMinAI,
		Hurt = mod.miniMinHurt,
	},
	[mod.FF.Gutter.Var] = {
		Update = mod.gutterAI,
		Hurt = mod.returnFalse
	},
	[mod.FF.Sixth.Var] = {
		Update = mod.sixthAI,
	},
	[mod.FF.Residuum.Var] = {
		Update = mod.residuumAI,
	},
	[mod.FF.Technician.Var] = {
		Update = mod.technicianAI,
	},
	[mod.FF.Looksee.Var] = {
		Update = mod.lookseeAI,
	},
	[mod.FF.Clergy.Var] = {
		Update = mod.clergyAI,
	},
	[mod.FF.Stolas.Var] = {
		Update = mod.stolasAI,
	},
	[mod.FF.Deathany.Var] = {
		Update = mod.deathanyAI,
		Hurt = mod.returnFalse
	},
	[mod.FF.Bull.Var] = {
		Update = mod.bullAI,
		Hurt = mod.bullHurt
	},
	[mod.FF.Geyser.Var] = {
		Update = mod.geyserAI,
	},
	[mod.FF.SuperGrimace.Var] = {
		Update = mod.superGrimaceAI,
		Hurt = mod.returnFalse
	},
	[mod.FF.MagGaper.Var] = {
		Update = mod.magGaperAI,
	},
	[mod.FF.Aper.Var] = {
		Update = mod.aperAI,
	},
	[mod.FF.Matte.Var] = {
		Update = mod.matteAI,
		Hurt = mod.matteHurt
	},
	[mod.FF.BunkerWorm.Var] = {
		Update = mod.bunkerWormAI,
	},
	[mod.FF.Buckethead.Var] = {
		Update = mod.bucketheadAI,
		Hurt = mod.bucketheadHurt,
		Remove = mod.clearGridCollonRemove,
	},
	[mod.FF.Bubby.Var] = {
		Update = mod.bubbyAI,
	},
	[mod.FF.Discy.Var] = {
		Update = mod.discyRelay,
		Hurt = mod.discyHurt,
		Coll = mod.discyCollision
	},
	[mod.FF.Beebee.Var] = {
		Update = mod.beebeeAI,
	},
	[mod.FF.Delinquent.Var] = {
		Update = mod.delinquentAI,
		Hurt = mod.delinquentHurt,
		Coll = mod.delinquentCollision,
		Remove = mod.delinquentDeath,
	},
	[mod.FF.Slobber.Var] = {
		Update = mod.slobberFormerlyDroolyAI,
	},
	[mod.FF.Bleedy.Var] = {
		Update = mod.slobberFormerlyDroolyAI,
	},
	[mod.FF.PaleBleedy.Var] = {
		Update = mod.slobberFormerlyDroolyAI,
	},
	[mod.FF.Grinner.Var] = {
		Update = mod.GrinnerAI,
		Hurt = mod.GrinnerHurt
	},
	[mod.FF.MobileMushroom.Var] = {
		Update = mod.mobileMushroomAI,
		Hurt = mod.mobileMushroomHurt
	},
	[mod.FF.Onlyfan.Var] = {
		Update = mod.onlyfanAI,
	},
	[mod.FF.Trojan.Var] = {
		Update = mod.trojanUpdate,
		Hurt = mod.trojanHurt
	},
}

--------------------------------------------------------------------------------------------

function mod:runErflyAI(npc)
	local variant = npc.Variant
	local subType = npc.SubType
	if mod.ErflyEnemyDict[variant] and mod.ErflyEnemyDict[variant].Update then
		mod.ErflyEnemyDict[variant].Update(_,npc,subType,variant)
	end
end
mod:AddCallback(ModCallbacks.MC_NPC_UPDATE, mod.runErflyAI, mod.FFID.Erfly)

function mod:runErflyInit(npc)
	local variant = npc.Variant
	local subType = npc.SubType
	if mod.ErflyEnemyDict[variant] and mod.ErflyEnemyDict[variant].Init then
		mod.ErflyEnemyDict[variant].Init(_,npc,subType,variant)
	end
end
mod:AddCallback(ModCallbacks.MC_POST_NPC_INIT, mod.runErflyInit, mod.FFID.Erfly)

function mod:runErflyColl(npc1, npc2, mysteryBoolean)
	local variant = npc1.Variant
	if mod.ErflyEnemyDict[variant] and mod.ErflyEnemyDict[variant].Coll then
		return mod.ErflyEnemyDict[variant].Coll(_,npc1,npc2)
	end
end
mod:AddCallback(ModCallbacks.MC_PRE_NPC_COLLISION, mod.runErflyColl, mod.FFID.Erfly)

function mod:runErflyHurt(npc, damage, flag, source)
	local variant = npc.Variant
	if mod.ErflyEnemyDict[variant] and mod.ErflyEnemyDict[variant].Hurt then
		return mod.ErflyEnemyDict[variant].Hurt(_,npc, damage, flag, source)
	end
end
mod:AddCallback(ModCallbacks.MC_ENTITY_TAKE_DMG, mod.runErflyHurt, mod.FFID.Erfly)

function mod:runErflyKill(npc)
	local variant = npc.Variant
	if mod.ErflyEnemyDict[variant] and mod.ErflyEnemyDict[variant].Kill then
		mod.ErflyEnemyDict[variant].Kill(_,npc, variant)
	end
end
mod:AddCallback(ModCallbacks.MC_POST_ENTITY_KILL, mod.runErflyKill, mod.FFID.Erfly)

function mod:runErflyDeath(npc)
	local variant = npc.Variant
	if mod.ErflyEnemyDict[variant] and mod.ErflyEnemyDict[variant].Death then
		mod.ErflyEnemyDict[variant].Death(_,npc, variant)
	end
end
mod:AddCallback(ModCallbacks.MC_POST_NPC_DEATH, mod.runErflyDeath, mod.FFID.Erfly)

function mod:runErflyRemove(npc)
	local variant = npc.Variant
	if mod.ErflyEnemyDict[variant] and mod.ErflyEnemyDict[variant].Remove then
		mod.ErflyEnemyDict[variant].Remove(_,npc)
	end
end
mod:AddCallback(ModCallbacks.MC_POST_ENTITY_REMOVE, mod.runErflyRemove, mod.FFID.Erfly)

--------------------------------------------------------------------------------------------
--Projectiles

function mod.erflyProjectiles(v,d)
	mod.psionprojupdate(v,d)
	mod.crosseyesprojupdate(v,d)
	mod.peeplingprojupdate(v,d)
	mod.peepingprojupdate(v,d)
	mod.moistroprojupdate(v,d)
	mod.ghostseProjOverride(v,d)
	mod.lookerProjectiles(v,d)
	mod.technoPinAnnoyance(v,d)
    mod.battieprojupdate(v, d)
    mod.seekerProjectiles(v, d)
	mod.sixthProj(v, d)
	mod.clergyProj(v, d)
	mod.AperProj(v, d)
	mod.drunkwormProj(v, d)
	mod.deepDwellerLudo(v, d)
	mod.wineDukeProj(v,d)
end

--------------------------------------------------------------------------------------------
--Effects

function mod:runSquireClubAI(e)
	if e.SubType == 1 then
		mod:psiHunterSwordAI(e)
	else
		mod:squireClubAI(e)
	end
end
mod:AddCallback(ModCallbacks.MC_POST_EFFECT_UPDATE, mod.runSquireClubAI, 7011)

function mod:checkStingerPoof(e)
	e.SpriteOffset = Vector(0, -15)
	local sprite = e:GetSprite()
	if sprite:IsFinished("Poof") then
		e:Remove()
	else
		mod:spritePlay(sprite, "Poof")
	end
end
mod:AddCallback(ModCallbacks.MC_POST_EFFECT_UPDATE, mod.checkStingerPoof, 7014)

function mod:slippyFartAI(e)
	local sprite = e:GetSprite()
	local d = e:GetData()

	if sprite:IsFinished("PoofStart") then
		mod:spritePlay(sprite, "PoofLoop")
	end



	if e.FrameCount > 300 then
		if sprite:IsFinished("PoofEnd") then
			e:Remove()
		else
			mod:spritePlay(sprite, "PoofEnd")
		end
	elseif e.FrameCount % 5 == 0 then
		for _, entity in pairs(Isaac.FindInRadius(e.Position, 50 * (d.RadiusMult or 1), EntityPartition.ENEMY)) do
			if entity:ToNPC() and (entity:GetData().LastFrameDamagedByGutCloud or 0) <= Game():GetFrameCount() - 5 then
				entity:TakeDamage(5, 0, EntityRef(entity), 0)
				if not entity:HasEntityFlags(EntityFlag.FLAG_POISON) then
					entity:AddPoison(EntityRef(Isaac.GetPlayer(0)), 60, 5)
				end
				entity:GetData().LastFrameDamagedByGutCloud = Game():GetFrameCount()
			end
		end
	end
end

function mod:chirumiruFlashAI(e)
	local sprite = e:GetSprite()
	e.RenderZOffset = -30000
	if sprite:IsFinished("Flash") then
		e:Remove()
	else
		mod:spritePlay(sprite, "Flash")
	end

end

function mod:bigMegaSplash(e)
	local sprite = e:GetSprite()
	e.SpriteOffset = Vector(0, -15)
	if sprite:IsFinished("Sploosh") then
		e:Remove()
	end
end
function mod:isaacSmonkingAI(e)
	if e.Parent and e.Parent:Exists() then
		local sprite = e:GetSprite()
		local sfx = SFXManager()
		if sprite:IsFinished("Smonk") then
			e:Remove()
			e.Parent:Update()
		elseif sprite:IsEventTriggered("RadDude") then
			sfx:Play(SoundEffect.SOUND_POWERUP1,1,0,false,1)
		elseif sprite:IsEventTriggered("Vwoop") then
			sfx:Play(SoundEffect.SOUND_SHELLGAME,1,0,false,1)
		elseif sprite:IsEventTriggered("Blaze") then
			sfx:Play(SoundEffect.SOUND_MENU_FLIP_DARK,1,0,false,1.7)
		elseif sprite:IsEventTriggered("Exhale") then
			--sfx:Play(SoundEffect.SOUND_CANDLE_LIGHT,1,0,false,0.8)
		elseif sprite:IsEventTriggered("ThumbsUp") then
			sfx:Play(SoundEffect.SOUND_THUMBSUP,1,0,false,1)
		end
	else
		e:Remove()
	end
end

function mod:FFWhiteSmokeAI(e)
    local sprite, d = e:GetSprite(), e:GetData()
	if not d.init then
		if d.longonly then
			d.anim = math.random(4,5)
			if math.random(2) == 1 then 
				sprite.FlipX = true 
			end
		else
			--Default Behaviour
			d.anim = d.anim or math.random(4)
		end
		d.init = true
	end
	if sprite:IsFinished("Fade" .. d.anim) then
		e:Remove()
	else
		mod:spritePlay(sprite, "Fade" .. d.anim)
	end
end

function mod:check960Effect(e)
	local subt = e.SubType
	if subt == mod.FF.DummyRopeTarget.Sub then
		mod:dummyRopeTargetAI(e)
	elseif subt == mod.FF.SlippyFart.Sub then
		mod:slippyFartAI(e)
	elseif subt == mod.FF.LyreParticle.Sub then
		mod:lyreParticleAI(e)
	elseif subt == mod.FF.FFWhiteSmoke.Sub then
		mod:FFWhiteSmokeAI(e)
	elseif subt == mod.FF.PsychicRing.Sub then
		mod:psychicRingAI(e)
	elseif subt == mod.FF.LoveHeart.Sub then
		mod:loveHeartAI(e)
	elseif subt == mod.FF.ChirumiruFlash.Sub then
		mod:chirumiruFlashAI(e)
	elseif subt == mod.FF.MimeBlock.Sub then
		mod:mimeBlockAI(e)
	elseif subt == mod.FF.DuskFog.Sub then
		mod:duskFogOfWarAI(e)
	elseif subt == mod.FF.DuskHandAfterimage.Sub then
		mod:duskHandAfterimageAI(e)
	elseif subt == mod.FF.FakeDusk.Sub then
		mod:fakeDuskAI(e)
	elseif subt == mod.FF.FakeBloodpoof.Sub then
		mod:fakeBloodpoofAI(e)
	elseif subt == mod.FF.DuskArm.Sub then
		mod:duskArmAI(e)
	elseif subt == mod.FF.PokerWager.Sub then
		mod:pokerWagerAI(e)
	elseif subt == mod.FF.ClutchFamiliarTail.Sub then
		mod:lilClutchTailAI(e)
	elseif subt == mod.FF.KalusVisage.Sub then
		mod:kalusVisageAI(e)
	elseif subt == mod.FF.NilPastaEnd.Sub then
		mod:nilPastaEnd(e)
	elseif subt == mod.FF.WhiteSquareEffect.Sub then
		mod:nilPastaSquaresAI(e)
	elseif subt == mod.FF.GrapplingHook.Sub then
		mod:grapplingHookAI(e)
	elseif subt == mod.FF.SanguineHook.Sub or subt == mod.FF.SanguineHookSmall.Sub then
		mod:sanguineHookAI(e)
	elseif subt == mod.FF.SwallowedM90Gun.Sub then
		mod:m90GunAI(e)
	elseif subt == mod.FF.GolemsAssaultRifle.Sub then
		mod:friendlyRapidFireOpalGunAI(e)
	elseif subt == mod.FF.GolemsARBulletCase.Sub then
		mod:friendlyRapidFireOpalGunBulletCaseAI(e)
	elseif subt == mod.FF.BigMegaSplash.Sub then
		mod:bigMegaSplash(e)
	elseif subt == mod.FF.DeadVermin.Sub then
		mod:deadVerminAI(e)
	elseif subt == mod.FF.OnlyfanAfterimage.Sub then
		mod:onlyfanAfterimage(e)
	elseif subt == mod.FF.FFKnifeSwipe.Sub then
		mod:knifeSwipeAI(e)
	elseif subt == mod.FF.DyingMiniMin.Sub then
		mod:dyingMiniMinAI(e)
	elseif subt == mod.FF.TechnicianProjEf.Sub then
		mod:dyingTechShotAI(e)
	elseif subt == mod.FF.LookseeHand.Sub then
		mod:lookseeHandAI(e)
	elseif subt == mod.FF.BallOfMalice.Sub or subt == mod.FF.BallOfMinion.Sub then
		mod:ballOfMaliceAI(e)
	elseif subt == mod.FF.MaliceMinionGhost.Sub then
		mod:maliceMinionGhostAI(e)
	elseif subt == mod.FF.IsaacSmonking.Sub then
		mod:isaacSmonkingAI(e)
	elseif subt == mod.FF.CacaWhirlpool.Sub then
		mod:cacawhirlpoolAI(e)
	elseif subt == mod.FF.AwesomePointingArrow.Sub then
		mod:AwesomePointingArrowAI(e)
	elseif subt == mod.FF.SomethingThatFades.Sub then
		mod:SomethingThatFadesAI(e)
	elseif subt == mod.FF.Dogboard.Sub then
		mod:dogboardEffectUpdate(e)
	elseif subt == mod.FF.LittlePhone.Sub then
		mod:littlePhoneUpdate(e)
	elseif subt == mod.FF.CameraFlash.Sub then
		mod:toyCameraFlashUpdate(e)
	elseif subt == mod.FF.AxeProjectile.Sub then
		mod:chaldeanAxeUpdate(e)
	elseif subt == mod.FF.AxeProjectileAfter.Sub then
		mod:chaldeanAxeEffectUpdate(e)
	elseif subt == mod.FF.TelebombsCrosshair.Sub then
		mod:telebombsMarkerUpdate(e)
	elseif subt == mod.FF.DevilsDagger.Sub then
		mod:devilsDaggerUpdate(e)
	elseif subt == mod.FF.DevilsDaggerGem.Sub then
		mod:devilsDaggerGemUpdate(e)
	elseif subt == mod.FF.NitroStatus.Sub then
		mod:nitroStatusIndicatorUpdate(e)
	elseif subt == mod.FF.InfinityVoltEnd.Sub then
		mod:infinityVoltCordEndUpdate(e)
	end
end

mod:AddCallback(ModCallbacks.MC_POST_EFFECT_UPDATE, mod.check960Effect, 1960)

function mod:render960Effect(e, offset)
	local subt = e.SubType
	if subt == mod.FF.SanguineHook.Sub or subt == mod.FF.SanguineHookSmall.Sub then
		mod:sanguineHookRender(e, offset)
	elseif subt == mod.FF.TelebombsCrosshair.Sub then
		--mod:sanguineHookRender(e, offset)
	elseif subt == mod.FF.BallOfMalice.Sub then
		mod:ballOfMaliceRender(e, offset)
	end
end

mod:AddCallback(ModCallbacks.MC_POST_EFFECT_RENDER, mod.render960Effect, 1960)

--------------------------------------------------------------------------------------------
--Items

local aimBlacklist = {
	[CollectibleType.COLLECTIBLE_GRAPPLING_HOOK] 	= true,
	[FiendFolio.ITEM.COLLECTIBLE.KALUS_HEAD] 		= true,
}

function mod:heldItemsPlayerUpdate(player, data)
	local sfx = SFXManager()
	
	--Holding stuff up
	if data.holdingFFItem then
		if player:IsExtraAnimationFinished() and not (data.holdingFFItem == mod.ITEM.COLLECTIBLE.SANGUINE_HOOK and Isaac.GetChallenge() == mod.challenges.isaacRebuilt) then
			data.holdingFFItem = nil
			data.holdingFFItemSlot = nil
		end
		local aim = player:GetAimDirection()
		local lockAngle
		if not aimBlacklist[data.holdingFFItem] then
			if not (player:HasCollectible(CollectibleType.COLLECTIBLE_ANALOG_STICK) or data.firingSanguineHookShot) then
				if player:HasCollectible(CollectibleType.COLLECTIBLE_MOMS_KNIFE) then
					lockAngle = 45
				else
					lockAngle = 90
				end
			end
		end
		if lockAngle then
			aim = mod:SnapVector(aim, lockAngle)
		end
		if data.holdingFFItem == FiendFolio.ITEM.COLLECTIBLE.KALUS_HEAD then
			mod:useHeldKaluHead(player, data, aim)
		else
			if aim:Length() > 0.5 then
				aim = aim:Normalized()
				if data.holdingFFItem == CollectibleType.COLLECTIBLE_SANGUINE_HOOK then
					mod:useHeldSanguineHook(player, data, aim)
				elseif data.holdingFFItem == CollectibleType.COLLECTIBLE_GRAPPLING_HOOK then
					mod:useHeldGrapplingHook(player, data, aim)
				elseif data.holdingFFItem == CollectibleType.COLLECTIBLE_TOY_CAMERA then
					mod:useHeldItemToyCamera(player, data, aim)
				elseif data.holdingFFItem == mod.ITEM.COLLECTIBLE.LEMON_MISHUH then
					mod:throwLemonMishuh(player, data, aim)
				elseif data.holdingFFItem == mod.ITEM.COLLECTIBLE.D2 then
					mod:throwD2(player, data, aim)
				end
				if data.holdingFFItem and (not data.firingSanguineHookShot) then
					if data.HoldingFFItemBlankVisual then
						player:AnimateCollectible(-1, "HideItem", "PlayerPickup")
						data.HoldingFFItemBlankVisual = nil
					else
						player:AnimateCollectible(data.holdingFFItem, "HideItem", "PlayerPickup")
					end
				else
					data.firingSanguineHookShot = nil
				end
				data.holdingFFItem = nil
				data.holdingFFItemSlot = nil
				data.HoldingFFItemBlankVisual = nil
			end
		end
	else
		data.holdingFFItemSlot = nil
	end
end
--Prevents switching with schoolbag
mod:AddCallback(ModCallbacks.MC_INPUT_ACTION, function(_, ent, hook, buttonaction)
	if hook == InputHook.IS_ACTION_TRIGGERED and buttonaction == ButtonAction.ACTION_DROP then
		if ent and ent.Type == 1 then
			if Input.IsActionTriggered(ButtonAction.ACTION_DROP, ent:ToPlayer().ControllerIndex) then
				local d = ent:GetData()
				if d.holdingFFItem then
					return false
				end
			end
		end
	end
end, InputHook.IS_ACTION_TRIGGERED)

mod.DrawnItemTypes = {
	BrickRock = 0,
	SwallowedM90 = 1,
	ClutchsCurse = 2,
	RapidFireOpal = 3,
}

function mod:canUseDrawnItem(player, itemType, aim)
	if aim:Length() > 0.5 and player:IsExtraAnimationFinished() then
		local data = player:GetData()
		if data.holdingFFItem or data.FFdrawnItemCooldown then
			return false 
		elseif player:HasTrinket(FiendFolio.ITEM.ROCK.BRICK_ROCK) then
			if itemType == mod.DrawnItemTypes.BrickRock then
				return true
			end
		elseif data.drawnSwallowedM90 then
			if itemType == mod.DrawnItemTypes.SwallowedM90 then
				return true
			end
		elseif data.clutchsCursePurpleGutLump then
			if itemType == mod.DrawnItemTypes.ClutchsCurse then
				return true
			end
		elseif data.rapidFireOpalAmmo then
			if itemType == mod.DrawnItemTypes.RapidFireOpal then
				return true
			end
		end
	else
		return false
	end
end

function mod:drawnItemCooldown(player, d)
	if d.FFdrawnItemCooldown then
		d.FFdrawnItemCooldown = d.FFdrawnItemCooldown - 0.5
		if d.FFdrawnItemCooldown <= 0.5 then
			d.FFdrawnItemCooldown = nil
		end
	end
end

function mod:erflyPlayerUpdate(player, data)
	mod:drawnItemCooldown(player, data)
	mod:swallowedM90Drawn(player, data)
	mod:friendlyRapidFireOpalDrawn(player, data)
	mod:brickRockPlayer(player, data)
	mod:clutchsCursePlayerUpdate(player, data)

	mod:jevilstailPlayerUpdate(player, data)
	mod:monasHieroglyphicaUpdate(player, data)
	mod:solemnVowUpdate(player, data)
	mod:dogboardUpdate(player, data)
	mod:cetusUpdate(player, data)
	mod:pillShitPlayer(player, data)
	mod:blackmoonPlayerUpdate(player, data)
	mod:heldItemsPlayerUpdate(player, data)
	mod:sanguineHookPlayerUpdate(player, data)
	mod:funnyBindsPlayerData(player, data)
	mod:dadsPostichePostPlayerUpdate(player, data)
	mod:checkDidPlayerDieForFunny(player, data)
	mod:handlePlayerCustomSlow(player, data)
	mod:chaldeanAxePlayerUpdate(player, data)
	mod:erflyCustomCommandsPlayerUpdate(player, data)
	mod:telebombsPlayerUpdate(player, data)
	mod:fiddlecubePlayerUpdaet(player, data)
	mod:goldenSlotMachinePlayerEffects(player, data)
	mod:devilsDaggerPlayerUpdate(player, data)
	mod:nitroCrystalPlayerEffects(player, data)
	mod:emojiGlassesPlayerUpdate(player, data)
	mod:slippyPlayerUpdate(player, data)
	mod:devilsAbacusPlayerUpdate(player, data)
	mod:grabberItemQueueCheck(player, data)
	mod:infinityVoltPlayerUpdate(player, data)
	mod:unobtainiumPlayerUpdate(player, data)
	mod:angelicLyrePlayerUpdate(player, data)
	mod:deadlyDosePlayerUpdate(player, data)
	mod:grapplingHookPlayerUpdate(player, data)
	mod:mimeDegreePlayerUpdate(player, data)
	mod:crazyJackpotPlayerUpdate(player, data)
	mod:middleHandPlayerUpdate(player, data)
end

mod:AddCallback(ModCallbacks.MC_POST_PLAYER_RENDER, function(_, player, offset)
	local d = player:GetData()
	mod:cyanidePlayerRender(player, offset, d)
	mod:crazyJackpotPlayerRender(player, offset, d)
	--mod:kalusHeadPlayerRender(player, offset, d)
end)

function mod:erflyPeffectUpdate(player, data, saveData)
	mod:slippyPeffectUpdate(player, data)
	mod:thankYouFossilPeffectUpdate(player, data)
	mod:rainbowBeanPeffectUpdate(player, data)
	mod:yourEternalRewardPlayerUpdate(player, data)
end

function mod:erflyPlayerHurt(player, amount, flags, source, cooldown)
	--On hit effects (ignores dark esau)
	if not (player:GetPlayerType() == PlayerType.PLAYER_JACOB_B and source.Type == EntityType.ENTITY_DARK_ESAU) then
		mod:swallowedM90PlayerHurt(player)
		mod:bloodDiamondPlayerHurt(player)
		mod:cetusPlayerHurt(player)
		mod:lilLambPlayerHurt(player)
		mod:crazyJackpotPlayerHurt(player)
	end
end

function mod:erflyPrePlayerCollision(player, collider)
	mod:sanguineHookPlayerColl(player, collider)
	mod:grapplingHookPlayerColl(player, collider)
end

function mod:erflyOnDoubleTap(player, data, sdata)
	local aim = mod.GetGoodShootingJoystick(player)
	local lockAngle
	if not player:HasCollectible(CollectibleType.COLLECTIBLE_ANALOG_STICK) then
		if player:HasCollectible(CollectibleType.COLLECTIBLE_MOMS_KNIFE) then
			lockAngle = 45
		else
			lockAngle = 90
		end
	end
	if lockAngle then
		aim = mod:SnapVector(aim, lockAngle)
	end

	mod:infinityVoltDoubleTap(player, aim, data, sdata)
	mod:petPeeveDoubleTap(player, aim, data, sdata)
end

function mod:SetTearFlag(x)
    return x >= 64 and BitSet128(0,1<<(x - 64)) or BitSet128(1<<x,0)
end

--Tear rubbish

function mod:erflyPostFireTear(player, tear, secondHandMultiplier, ignorePlayerEffects, isLudo)
	local pdata = player:GetData()
	local tdata = tear:GetData()
	local rng = tear:GetDropRNG()
	mod:rapidFireOpalPostFireTear(player, tear, rng, pdata, tdata, secondHandMultiplier)

	--mod:brickRockFire(player, tear, rng, pdata, tdata)
	mod:devilsUmbrellaPostFire(player, tear, rng, pdata, tdata, ignorePlayerEffects, isLudo)
	mod:beeSkinPostFire(player, tear, rng, pdata, tdata, ignorePlayerEffects, isLudo)
	mod:modernOuroborosPostFireTear(player, tear, rng, pdata, tdata, ignorePlayerEffects, isLudo)
	mod:sapphicSapphireFire(player, tear, rng, pdata, tdata)
	mod:rerolliganFossilFire(player, tear, rng, pdata, tdata)
	mod:bloodDiamondFire(player, tear, rng, pdata, tdata)
	mod:dadsPostichePostFire(player, tear, rng, pdata, tdata)
	mod:blackMoonPostFire(player, tear, rng, pdata, tdata)
	mod:emojiGlassesPostFire(player, tear, rng, pdata, tdata, secondHandMultiplier)
	mod:slippyPostFireTear(player, tear, rng, pdata, tdata, ignorePlayerEffects, isLudo)
	mod:devilsAbacusPostFireTear(player, tear, rng, pdata, tdata, ignorePlayerEffects, isLudo)
	mod:timeItselfOnFireTear(player, tear, tdata, secondHandMultiplier)
	mod:horncobPostFire(player, tear, rng, pdata, tdata)
	mod:fientPostFire(player, tear, rng, pdata, tdata)
	--keep at end
	mod:angelicLyrePostFireTear(player, tear, rng, pdata, tdata, ignorePlayerEffects, isLudo)
end

function mod:erflyTearUpdate(tear, tdata)
	mod:brickRockUpdate(tear, tdata)
	mod:emojiTearUpdate(tear, tdata)
	mod:euclideanTearUpdate(tear, tdata)
end

function mod:erflyPreTearCollision(tear, ent, tdata)
	--mod:brickRockColl(tear, ent, tdata)
	--mod:rerolliganFossilColl(tear, ent, tdata)
	--mod:bloodDiamondColl(tear, ent, tdata)
	mod:emojiGlassesPreTear(tear, ent, tdata)
end

function mod:erflyPostTearRemove(tear,data)
	mod:modernOuroborosPostTearRemove(tear,data)
	mod:cetusTearDeath(tear,data)
	mod:emojiTearDeath(tear,data)
	mod:lemonMishuhTearDeath(tear, data)
	mod:mernsCherryBombProjectileDeath(tear, data)
end

function mod:erflyOnTearDamage(tear, data)
	--local player = tear.SpawnerEntity:ToPlayer()
	--if player then
		mod:modernOuroborosTearDamage(tear, data)
	--end
end

--Dr. Fetus

function mod:erflyPostFireBomb(player, bomb, secondHandMultiplier)
	local rng = bomb:GetDropRNG()
	local pdata = player:GetData()
	local bdata = bomb:GetData()
	mod:dadsPostichePostFireBomb(player, bomb, rng)
	mod:blackMoonPostFireBomb(player, bomb, rng)
	mod:emojiPostFireBomb(player, bomb, rng, secondHandMultiplier)
	mod:devilsUmbrellaPostFireBomb(player, bomb, rng)
	mod:beeSkinPostFireBomb(player, bomb, rng, pdata, bdata)
	mod:timeItselfOnFireBomb(player, bomb, rng, pdata, bdata, secondHandMultiplier)
	mod:modernOuroPostFireBomb(player, bomb, rng, pdata, bdata)
	mod:sapphicSapphirePostFireBomb(player, bomb, rng, pdata, bdata)
	mod:bloodDiamondPostFireBomb(player, bomb, rng, pdata, bdata)
	--keep at end
	mod:angelicLyrePostFireBomb(player, bomb, rng, pdata, bdata)
end

function mod:erflyPostBombUpdate(bomb, data)
	mod:handleExplosionsInItemDungeons(bomb)
	if bomb.IsFetus then
		mod:emojiPostBombUpdate(bomb, data)
		mod:multiEuclideanPostBombUpdate(bomb, data)
		--mod:beeSkinPostBombUpdate(bomb, data)
		mod:modernOuroborosPostBombUpdate(bomb, data)
	end
end

function mod:erflyPostBombRender(bomb, offset, data)
	mod:emojiPostBombRender(bomb, data, offset)
end

--Lasers

function mod:erflyPostFireLaser(player, laser)
	if laser.Variant == 10 then return end
	local rng = laser:GetDropRNG()
	mod:sapphicSapphireFireLaser(player, laser, rng)
	mod:blackMoonFireLaser(player, laser, rng)
	mod:emojiGlassesPreFireLaser(player, laser)
	--If you need details such as the direction the laser is firing
	FiendFolio.scheduleForUpdate(function()	
		mod:beeskinPostFireLaser(player, laser)
		mod:dadsPostichePostFireLaser(player, laser, rng)
		mod:emojiGlassesPostFireLaser(player, laser, rng)
		mod:devilsUmbrellaPostFireLaser(player, laser, rng)

		mod:angelicLyrePostFireLaser(player, laser, rng)
	end, 2)

	if rng:RandomInt(100000) == 0 then
		mod:tryMakeLaserTrans(laser)
	end
end

function mod:erflyPostLaserUpdate(player, laser, data)
	local rng = laser:GetDropRNG()
	mod:emojiGlassesPostLaserUpdate(player, laser, data, rng)
	mod:dazzlingSlotLaserUpdate(player, laser, data, rng)
	mod:multiEuclideanLaserUpdate(player, laser, data, rng)
	mod:beeSkinLaserUpdate(player, laser, data, rng)
end

function mod:erflyOnLaserDamage(player, entity, secondHandMultiplier)
	mod:timeItselfOnLaserDamage(player, entity, secondHandMultiplier)
	mod:modernOuroOnGenericDamage(player, entity)
	mod:sapphicSapphireOnGenericDamage(player, entity)
	mod:bloodDiamondOnGenericDamage(player, entity)
	mod:smashTrophyAwayFromPlayerDamage(player, entity)
end

--Knife

function mod:erflyPostFireKnife(player, knife, kdata)
	local rng = knife:GetDropRNG()
	mod:dadsPostichePostFireKnife(player, knife, rng)
	mod:devilsUmbrellaPostFireKnife(player, knife, rng)
	mod:beeSkinPostFireKnife(player, knife, rng)

	mod:angelicLyrePostFireKnife(player, knife, rng, kdata)
end

function mod:erflyOnKnifeUpdate(player, knife, kdata)
	mod:blackMoonOnKnifeUpdate(player, knife)
end

function mod:erflyOnKnifeReset(player, knife, kdata)
	if kdata.RemoveOnReturn then
		knife:Remove()
	end
end

function mod:erflyOnKnifeDamage(player, entity, secondHandMultiplier)
	mod:timeItselfOnKnifeDamage(player, entity, secondHandMultiplier)
	mod:modernOuroOnGenericDamage(player, entity)
	mod:sapphicSapphireOnGenericDamage(player, entity)
	mod:bloodDiamondOnGenericDamage(player, entity)
	mod:smashTrophyAwayFromPlayerDamage(player, entity)
end

function mod:erflyOnFireRocket(player, target, secondHandMultiplier)
	mod:blackMoonOnRocketFire(player, target)
	mod:emojiGlassesOnRocketFire(player, target, secondHandMultiplier)
	mod:timeItselfOnRocketFire(player, target, secondHandMultiplier)
	mod:modernOuroOnRocketFire(player, target)
	mod:sapphicSapphireOnRocketFire(player, target)
	mod:bloodDiamondOnRocketFire(player, target)
end

function mod:erflyPostRocketExplosion(explosion, rocket)
	mod:modernOuroOnRocketExplosion(explosion, rocket)
end

function mod:erflyOnFireAquarius(player, creep, secondHandMultiplier)
	mod:blackMoonOnFireAquarius(player, creep)
	mod:timeItselfOnFireAquarius(player, creep, secondHandMultiplier)
	mod:sapphicSapphireOnFireAquarius(player, creep)
	mod:bloodDiamondOnFireAquarius(player, creep)
end

function mod:erflyOnDarkArtsDamage(player, entity, secondHandMultiplier)
	mod:modernOuroOnGenericDamage(player, entity)
	mod:timeItselfOnDarkArtsDamage(player, entity, secondHandMultiplier)
	mod:sapphicSapphireOnGenericDamage(player, entity)
	mod:bloodDiamondOnGenericDamage(player, entity)
	mod:smashTrophyDarkArtsDamage(player, entity)
end

function mod:erflyGenericDamage(source, entity, data)
	--[[if source.Type == EntityType.ENTITY_TEAR or
	(source.Type == EntityType.ENTITY_BOMBDROP and flags == flags | DamageFlag.DAMAGE_EXPLOSION) or
	(source.Type == EntityType.ENTITY_EFFECT and source.Variant == EffectVariant.PLAYER_CREEP_HOLYWATER_TRAIL) or
	(source.Type == EntityType.ENTITY_EFFECT and source.Variant == EffectVariant.ROCKET)
	then
	end]] --Passed entities

	mod:sapphicSapphireFireRocketAquariusDamage(source, entity, data)
	mod:BloodDiamondTBARDamage(source, entity, data)
	mod:smashTrophyGenericDamage(source, entity, data)
end

function mod:erflyPrePlayerNewRoom()
	mod.FlooringUpgrades = nil
	--Funcs
	mod:jevilstailNewRoom()
	mod:flowerCrownNewRoom()
	mod:goldenSlotMachineNewRoom()
end

function mod:erflyPlayerNewRoom(player, d, savedata)
	mod:jevilstailPlayerNewRoom(player, d, savedata)
	mod:slippyPlayerNewRoom(player, d, savedata)
	mod:mimePlayerNewRoom(player, d, savedata)
	mod:crazyJackpotPlayerNewRoom(player, d, savedata)
	mod:friendlyRapidFireOpalNewRoom(player, d, savedata)
end

function mod:erflyPostPlayerNewRoom()
	mod:jevilstailHandleActiveEffects()
	mod:greenHouseDadsHome()
	mod.tryDoRoomMist()
	mod.toyCameraNewRoomReset()
	mod.updateLilLambOnNewRoom()
	mod.sanguineHookNewRoom()
	mod.ratPoisonRoom()
	mod.clutchsCurseNewRoom()
end

function mod:erflyPreSpawnAward(spawnPos, dropRNG)
	mod:gregRoomClear()
	mod:spicyBagRoomClear()
	mod:bobbyBagRoomClear()
	mod:cyanideRoomClear(spawnPos, dropRNG)
end

function mod:erflyGlobalNPCUpdate(npc, data)
	--mod:jevilBruseEnemies(npc) -- moving this to status code to avoid issues surrounding enemies updating multiple times a frame or not updating on a frame
	mod:kaluHeadEntityUpdate(npc, data)
	mod:modernOuroEntityUpdate(npc, data)
	mod:smashTrophyEntityUpdate(npc, data)
end

function mod:erflyPostNewLevelPlayer(player, d)
	mod:monasHieroglyphicaNewStage(player, d)
	mod:devilsDaggerNewStage(player, d)
end

function mod:erflyPostNewLevelGeneral()
	if FiendFolio.savedata and FiendFolio.savedata.run then
		FiendFolio.savedata.run.ComposBarrelBeanFloor = nil
	end
end

function mod:erflyPostGameStart(continuing)
	mod:newGamePillShit(continuing)
	mod:handleSewingMachineCompat()
end

--postupdate
function mod:erflyOnUpdate()
	mod.roomMist()
	mod.duskDarkenShit()
	mod.blackMoonSoundStuff()
	mod.onUpdateMinichibisidian()
	mod.flooringUpgrade()
	mod.clutchCurseRocks()

	--Other shit
	if FiendFolio.PrintSFX then
		for i = 1, 1000 do
			if SFXManager():IsPlaying(i) then
				print(i)
			end
		end
	end
	--mod:checkPillReplacementsExist()
	--[[if Game():GetFrameCount() % 10 == 0 then
		mod.CurrentfloorColor = mod.CurrentfloorColor or {1,1,1,0,0,0}
		mod.floorColor = {math.random(200)/100,math.random(200)/100,math.random(200)/100,math.random(200)/100 - 1,math.random(200)/100 - 1,math.random(200)/100 - 1}
		mod.CurrentwallColor = mod.CurrentwallColor or {1,1,1,0,0,0}
		mod.wallColor = {math.random(200)/100,math.random(200)/100,math.random(200)/100,math.random(200)/100 - 1,math.random(200)/100 - 1,math.random(200)/100 - 1}
	end

	if mod.floorColor then
		for i = 1, 6 do
			mod.CurrentfloorColor[i] = mod:Lerp(mod.CurrentfloorColor[i], mod.floorColor[i], 0.2)
		end
		for i = 1, 6 do
			mod.CurrentwallColor[i] = mod:Lerp(mod.CurrentwallColor[i], mod.wallColor[i], 0.2)
		end
		Game():GetRoom():SetFloorColor(Color(mod.CurrentfloorColor[1], mod.CurrentfloorColor[2], mod.CurrentfloorColor[3], 1, mod.CurrentfloorColor[4], mod.CurrentfloorColor[5], mod.CurrentfloorColor[6]))
		--Game():GetRoom():SetWallColor(Color(mod.CurrentwallColor[1], mod.CurrentwallColor[2], mod.CurrentwallColor[3], 1, mod.CurrentwallColor[4], mod.CurrentwallColor[5], mod.CurrentwallColor[6]))
		Game():GetRoom():SetWallColor(Color(1,1,1,1,-1,-1,-1))
		--Game():GetRoom():SetWallColor()
	end]]

end

--Dunno a good place to put this, xandy halum function
function mod.GetGoodShootingJoystick(player)
    if player.ControllerIndex == 0 and Options.MouseControl and Input.IsMouseBtnPressed(0) then -- ControllerIndex 0 == Keyboard & Mouse
        return (Input.GetMousePosition(true) - player.Position):Normalized()
    else
        return player:GetShootingJoystick()
    end
end

function getShitpiss()
	local found = Isaac.FindByType(5, -1,-1, false, false)
	for _, ent in ipairs(found) do
		local pickup = ent:ToPickup()
		if pickup.Price then
			if pickup.Price > 0 or pickup.Price == -5 then
				print("Shop variant")
			else
				print("Devil variant")
			end
		end
	end
end

function FiendFolio:trySayAnnouncerLine(sfxid, useflags, delay)
	if not (useflags & UseFlag.USE_NOHUD > 0 or useflags & UseFlag.USE_MIMIC > 0) then
		local mode = Options.AnnouncerVoiceMode
		if mode == 2 or (mode == 0 and math.random(2) == 1) then
			if delay then
				mod.scheduleForUpdate(function()
					SFXManager():Play(sfxid, 2, 60, false, 1)
				end, delay, nil, true)	
			else
				SFXManager():Play(sfxid, 2, 60, false, 1)
			end
		end
	end
end

------------------------------------------------------------------------------
--Locusts

function mod:storeWhistleLocustDamage(player, locust, entity)
	if math.random(20) == 1 then
		mod.scheduleForUpdate(function()
			if entity then
				if entity:IsDead() or entity:HasMortalDamage() then
					local item = Isaac.Spawn(5,0,3, Game():GetRoom():FindFreePickupSpawnPosition(entity.Position, 0, false), Vector.Zero, nil):ToPickup()
					item.AutoUpdatePrice = false
					local rng = item:GetDropRNG()
					local rando = rng:RandomInt(3)
					if rando == 1 then
						item.Price = rng:RandomInt(10) + 1
					elseif rando == 2 then
						item.Price = rng:RandomInt(20) + 1
					else
						item.Price = rng:RandomInt(99) + 1
					end
					item.ShopItemId = -1
					local poof = Isaac.Spawn(1000, EffectVariant.POOF01, 15, item.Position, Vector.Zero, nil)
				end
			end
		end, 1)
	end
end

function mod:wrongWarpLocustAI(locust)
	if locust.FireCooldown == -1 then
		local randomvalue = ((math.random(100) - 50))
		locust.Velocity = locust.Velocity:Rotated(randomvalue)
	end
end

function mod:modelRocketLocustAI(locust)
	if locust.FireCooldown == -1 then
		locust.Velocity = locust.Velocity * 1.1
	end
end

function mod:siblingSylLocustInit(locust)
	if math.random(5) == 1 then
		local sprite = locust:GetSprite()
		sprite:ReplaceSpritesheet(1, "gfx/familiar/locusts/null.png")
		sprite:ReplaceSpritesheet(0, "gfx/familiar/locusts/ff/trans.png")
		sprite:LoadGraphics()
	end
end

function mod:spareRibsLocustUpdate(locust)
	if locust.State == 0 then
		locust:GetData().ShotRibs = nil
	end
end
function mod:spareRibsLocustDamage(player, locust, entity)
	if not locust:GetData().ShotRibs then
		SFXManager():Play(SoundEffect.SOUND_BONE_SNAP, 0.6, 0, false, 1.5)
		for i = 1, 3 do
			local tear = player:FireTear(locust.Position, Vector(11, 0):Rotated(i * 120), false, true, false):ToTear()
			tear.TearFlags = TearFlags.TEAR_PIERCING | TearFlags.TEAR_SPECTRAL
			tear.FallingAcceleration = 0
			tear.FallingAcceleration = 0
			tear.CollisionDamage = mod:getLocustDamage(locust, 0.1)
			tear:GetData().isrib = true
			--tear:GetSprite():Load("gfx/projectiles/boomerang rib.anm2", true)
			--tear:GetSprite():Play("friendly", true)
			mod:changeTearVariant(tear, TearVariant.BOOMERANG_RIB)
			locust:GetData().ShotRibs = true
		end
	end
end

function mod:ipadLocustDamage(player, locust, entity)
	local room = Game():GetRoom()
	entity.Position = Vector(entity.Position.X, room:GetGridHeight() * 50)
end

--[[function mod:mimeDegreeDamage(player,locust,entity)
	entity:TakeDamage(math.random(100)/100, DamageFlag.DAMAGE_NO_MODIFIERS, EntityRef(locust), 0)
end]]

function mod:leftoverTakeoutOnLocustDamage(player, locust, entity)
	local baseFortuneOdds = 17
	local freq = math.min(math.max(math.floor(22 - baseFortuneOdds - player.Luck), 3), 25)

	if math.random(freq) == 1 then
		mod:ShowFortune(false, true)
	end
end

mod.ErflyLocustDict = {
	[FiendFolio.ITEM.COLLECTIBLE.STORE_WHISTLE] = {
		Damage = mod.storeWhistleLocustDamage
	},
	[FiendFolio.ITEM.COLLECTIBLE.BABY_CRATER] = {
		Update = mod.babyCraterLocustAI
	},
	[FiendFolio.ITEM.COLLECTIBLE.SPARE_RIBS] = {
		Update = mod.spareRibsLocustUpdate,
		Damage = mod.spareRibsLocustDamage
	},
	[FiendFolio.ITEM.COLLECTIBLE.DEVILS_UMBRELLA] = {
		Update = mod.devilsUmbrellaLocustAI
	},
	[FiendFolio.ITEM.COLLECTIBLE.BEE_SKIN] = {
		Update = mod.beeSkinlocustAI
	},
	[FiendFolio.ITEM.COLLECTIBLE.MARIAS_IPAD] = {
		Damage = mod.ipadLocustDamage
	},
	[FiendFolio.ITEM.COLLECTIBLE.SLIPPYS_GUTS] = {
		Update = mod.frogLocustAI
	},
	[FiendFolio.ITEM.COLLECTIBLE.SLIPPYS_HEART] = {
		Update = mod.frogLocustAI
	},
	[FiendFolio.ITEM.COLLECTIBLE.LEFTOVER_TAKEOUT] = {
		Damage = mod.leftoverTakeoutOnLocustDamage
	},
	[FiendFolio.ITEM.COLLECTIBLE.MODERN_OUROBOROS] = {
		Damage = mod.modernOuroOnLocustDamage
	},
	[FiendFolio.ITEM.COLLECTIBLE.FROG_HEAD] = {
		Update = mod.frogLocustAI
	},
	[FiendFolio.ITEM.COLLECTIBLE.AVGM] = {
		Update = mod.avgmLocustAI
	},
	[FiendFolio.ITEM.COLLECTIBLE.FIDDLE_CUBE] = {
		Update = mod.fiddleCubeLocustAI
	},
	[FiendFolio.ITEM.COLLECTIBLE.BLACK_MOON] = {
		Update = mod.blackMoonlocustAI
	},
	[FiendFolio.ITEM.COLLECTIBLE.MODEL_ROCKET] = {
		Update = mod.modelRocketLocustAI
	},
	[FiendFolio.ITEM.COLLECTIBLE.SIBLING_SYL] = {
		Init = mod.siblingSylLocustInit
	},
	[FiendFolio.ITEM.COLLECTIBLE.WRONG_WARP] = {
		Update = mod.wrongWarpLocustAI
	},
	[FiendFolio.ITEM.COLLECTIBLE.X10BATOOMKLING] = {
		Damage = mod.batoomKlingOnLocustDamage
	},
	[FiendFolio.ITEM.COLLECTIBLE.INFINITY_VOLT] = {
		Update = mod.infinityVoltLocustAI,
	},
	[FiendFolio.ITEM.COLLECTIBLE.RAT_POISON] = {
		Damage = mod.ratPoisonOnLocustDamage
	},
	[FiendFolio.ITEM.COLLECTIBLE.MIME_DEGREE] = {
		Update = mod.mimeDegreeLocustAI,
		--Damage = mod.mimeDegreeDamage
	},
	[FiendFolio.ITEM.COLLECTIBLE.NIL_PASTA] = {
		Damage = mod.nilPastaOnLocustDamage
	},
	[FiendFolio.ITEM.COLLECTIBLE.TIME_ITSELF] = {
		Update = mod.timeItselfLocustAI,
		Damage = mod.timeItselfOnLocustDamage
	},
	[FiendFolio.ITEM.COLLECTIBLE.HORNCOB] = {
		Update = mod.horncoblocustAI
	},
	[FiendFolio.ITEM.COLLECTIBLE.BAG_OF_BOBBIES] = {
		Update = mod.bobbyBaglocustAI
	},
	[FiendFolio.ITEM.COLLECTIBLE.SMASH_TROPHY] = {
		Damage = mod.smashTrophyOnLocustDamage
	},
}

--fam.FireCooldown == -1 when charging
--fam.State == -1 when not orbiting

--Locusts
mod:AddCallback(ModCallbacks.MC_FAMILIAR_UPDATE, function(_, fam)
	local sub = fam.SubType
	if mod.ErflyLocustDict[sub] and mod.ErflyLocustDict[sub].Update then
		mod.ErflyLocustDict[sub].Update(_,fam,sub)
	end
end, FamiliarVariant.ABYSS_LOCUST)

mod:AddCallback(ModCallbacks.MC_FAMILIAR_INIT, function(_, fam)
	local sub = fam.SubType
	if mod.ErflyLocustDict[sub] and mod.ErflyLocustDict[sub].Init then
		mod.scheduleForUpdate(function()
			if fam and fam:Exists() then
				mod.ErflyLocustDict[sub].Init(_,fam,sub)
			end
		end, 0, nil, true)
	end
end, FamiliarVariant.ABYSS_LOCUST)

function mod:erflyOnLocustDamage(player, locust, entity, secondHandMultiplier, flags)
	if flags ~= flags | DamageFlag.DAMAGE_NO_MODIFIERS then
		local sub = locust.SubType
		if mod.ErflyLocustDict[sub] and mod.ErflyLocustDict[sub].Damage then
			mod.ErflyLocustDict[sub].Damage(_,player, locust, entity, secondHandMultiplier)
		end
	end
end

function mod:getLocustDamage(fam, mult)
	local player
	mult = mult or 1
	if fam.Player then
		player = fam.Player
		if fam.Player:HasCollectible(CollectibleType.COLLECTIBLE_BFFS) or fam.Player:HasCollectible(CollectibleType.COLLECTIBLE_HIVE_MIND) then
			mult = mult * 1.25
		end
	else
		player = Isaac.GetPlayer()
	end

	return player.Damage * mult
end